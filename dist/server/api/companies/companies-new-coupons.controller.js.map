{"version":3,"sources":["api/companies/companies-new-coupons.controller.js"],"names":["CompanyNewCouponsService","require","module","exports","req","res","accessToken","headers","access_token","userId","params","day","beforeDay","companyNewCouponsService","getIdsForAllUnReadPromotionalEmailsBeforeNDays","then","getCouponsPerCompany","email","messages","responseBody","ResponseBody","companiesList","status","send","catch","failedResponseBody","undefined","error","message","companies","errorMessage"],"mappings":";;AAAA;;;;AAIA,IAAIA,2BAA2BC,QAAQ,+BAAR,CAA/B;;AAEAC,OAAOC,OAAP,GAAiB,UAASC,GAAT,EAAcC,GAAd,EAAkB;;AAE/B,MAAIC,cAAcF,IAAIG,OAAJ,CAAYC,YAA9B;AACA,MAAIC,SAASL,IAAIM,MAAJ,CAAWD,MAAxB;AACA,MAAIE,MAAMP,IAAIM,MAAJ,CAAWE,SAArB;;AAEA,MAAIC,2BAA2B,IAAIb,wBAAJ,EAA/B;AACAa,2BAAyBC,8CAAzB,CAAwER,WAAxE,EAAqFG,MAArF,EAA6FE,GAA7F,EACGI,IADH,CACS,iBAAS;;AAEdF,6BAAyBG,oBAAzB,CAA8CV,WAA9C,EAA2DW,MAAMC,QAAjE,EAA2ET,MAA3E,EACGM,IADH,CACS,yBAAiB;;AAEpB,UAAII,eAAe,IAAIC,YAAJ,CAAiBC,aAAjB,CAAnB;AACAhB,UAAIiB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,YAArB;AACH,KALH,EAMGK,KANH,CAMU,iBAAS;AACf,UAAIC,qBAAqB,IAAIL,YAAJ,CAAiBM,SAAjB,EAA2BC,MAAMC,OAAjC,CAAzB;AACAvB,UAAIiB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBE,kBAArB;AACD,KATH;AAUD,GAbH,EAcGD,KAdH,CAcU,iBAAS;AACf,QAAIC,qBAAqB,IAAIL,YAAJ,CAAiBM,SAAjB,EAA2BC,MAAMC,OAAjC,CAAzB;AACAvB,QAAIiB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBE,kBAArB;AACD,GAjBH;AAkBH,CAzBD;;AA2BA,SAASL,YAAT,CAAsBS,SAAtB,EAAiCC,YAAjC,EAA+C;AAC7C,OAAKD,SAAL,GAAiBA,aAAa,EAA9B;AACA,OAAKC,YAAL,GAAoBA,gBAAgB,EAApC;AACD","file":"companies-new-coupons.controller.js","sourcesContent":["/**\n * Created by Carlos on 1/20/2017.\n */\n\nvar CompanyNewCouponsService = require('./company-new-coupons.service');\n\nmodule.exports = function(req, res){\n\n    var accessToken = req.headers.access_token;\n    var userId = req.params.userId;\n    var day = req.params.beforeDay;\n\n    var companyNewCouponsService = new CompanyNewCouponsService();\n    companyNewCouponsService.getIdsForAllUnReadPromotionalEmailsBeforeNDays(accessToken, userId, day)\n      .then( email => {\n\n        companyNewCouponsService.getCouponsPerCompany(accessToken, email.messages, userId)\n          .then( companiesList => {\n\n              var responseBody = new ResponseBody(companiesList);\n              res.status(200).send(responseBody);\n          })\n          .catch( error => {\n            var failedResponseBody = new ResponseBody(undefined,error.message);\n            res.status(400).send(failedResponseBody);\n          });\n      })\n      .catch( error => {\n        var failedResponseBody = new ResponseBody(undefined,error.message);\n        res.status(400).send(failedResponseBody);\n      });\n};\n\nfunction ResponseBody(companies, errorMessage) {\n  this.companies = companies || [];\n  this.errorMessage = errorMessage || '';\n}\n\n\n\n\n"]}