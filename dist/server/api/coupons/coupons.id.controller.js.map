{"version":3,"sources":["api/coupons/coupons.id.controller.js"],"names":["google","require","gmail","OAuth2","auth","credentials","oauth2Client","client_id","client_secret","redirect_uri","module","exports","req","res","accessToken","headers","access_token","userId","params","maxResults","query","company","setCredentials","users","messages","list","labelIds","q","err","response","console","log","status","code","send","errors"],"mappings":";;AAAA;;;;AAIA,IAAIA,SAASC,QAAQ,YAAR,CAAb;AACA,IAAIC,QAAQF,OAAOE,KAAP,CAAa,IAAb,CAAZ;AACA,IAAIC,SAASH,OAAOI,IAAP,CAAYD,MAAzB;AACA,IAAME,cAAcJ,QAAQ,uCAAR,CAApB;;AAEA,IAAIK,eAAe,IAAIH,MAAJ,CACjBE,YAAYE,SADK,EAEjBF,YAAYG,aAFK,EAGjBH,YAAYI,YAAZ,CAAyB,CAAzB,CAHiB,CAAnB;;AAMAC,OAAOC,OAAP,GAAiB,UAAUC,GAAV,EAAeC,GAAf,EAAmB;;AAElC,MAAIC,cAAcF,IAAIG,OAAJ,CAAYC,YAA9B;AACA,MAAIC,SAASL,IAAIM,MAAJ,CAAWD,MAAxB;AACA,MAAIE,aAAaP,IAAIM,MAAJ,CAAWC,UAAX,IAAyB,CAA1C;AACA,MAAIC,QAAQR,IAAIM,MAAJ,CAAWG,OAAvB;;AAEAf,eAAagB,cAAb,CAA4B;AAC1BN,kBAAcF;AADY,GAA5B;;AAIDZ,QAAMqB,KAAN,CAAYC,QAAZ,CAAqBC,IAArB,CAA0B;AACvBC,cAAU,qBADa;AAEvBT,YAAQA,MAFe;AAGvBb,UAAME,YAHiB;AAIvBa,gBAAYA,UAJW;AAKvBQ,OAAIP;AALmB,GAA1B,EAMI,UAAUQ,GAAV,EAAeC,QAAf,EAAyB;AAC3B,QAAGD,GAAH,EAAO;AACLE,cAAQC,GAAR,CAAYH,GAAZ;AACAf,UAAImB,MAAJ,CAAWJ,IAAIK,IAAf,EAAqBC,IAArB,CAA0B,EAACC,QAAQP,IAAIO,MAAb,EAA1B;AACD,KAHD,MAIK;AACHtB,UAAImB,MAAJ,CAAW,GAAX,EAAgBE,IAAhB,CAAqBL,SAASL,QAA9B;AACD;AACF,GAdD;AAeA,CA1BD","file":"coupons.id.controller.js","sourcesContent":["/**\n * Created by Carlos on 1/20/2017.\n */\n\nvar google = require('googleapis');\nvar gmail = google.gmail('v1');\nvar OAuth2 = google.auth.OAuth2;\nconst credentials = require('../../.credentials/google_credentials');\n\nvar oauth2Client = new OAuth2(\n  credentials.client_id,\n  credentials.client_secret,\n  credentials.redirect_uri[1]\n);\n\nmodule.exports = function (req, res){\n\n  var accessToken = req.headers.access_token;\n  var userId = req.params.userId;\n  var maxResults = req.params.maxResults || 1;\n  var query = req.params.company;\n\n  oauth2Client.setCredentials({\n    access_token: accessToken\n  });\n\n gmail.users.messages.list({\n    labelIds: 'CATEGORY_PROMOTIONS',\n    userId: userId,\n    auth: oauth2Client,\n    maxResults: maxResults,\n    q : query\n  }, function (err, response) {\n   if(err){\n     console.log(err);\n     res.status(err.code).send({errors: err.errors});\n   }\n   else {\n     res.status(200).send(response.messages);\n   }\n });\n};\n"]}